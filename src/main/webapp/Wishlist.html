<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wishlist</title>
<link rel="stylesheet" href="styles.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src = "notification.js"></script>
</head>
<body>
	<header>
		<h1>Wishlist Dashboard</h1>
	</header>
	<div id="navBar">
	<nav>
	  <a href="http://localhost:8080/ecommerce-auction-system/catalogue"><button class ="navButton">CATALOGUE</button></a> 
	  <a href="http://localhost:8080/ecommerce-auction-system/create-auction"><button class ="navButton">CREATE AUCTION</button></a> 
	  <a href="http://localhost:8080/ecommerce-auction-system/inbox"><button class ="navButton">INBOX</button></a> 
	  <a href="http://localhost:8080/ecommerce-auction-system/wishlist"><button class ="navButton">WISHLIST</button></a>  
	  <a href="http://localhost:8080/ecommerce-auction-system/logout"><button class ="navButton">LOGOUT</button></a>
	</nav>
</div>
<div id ="notification"></div>
	<div class="container">
		<table id="wishlistTable" border="1">
			<tr>
				<th>ID</th>
				<th>Name</th>
				<th>Highest Price</th>
				<th>Auction End Time</th>
				<th>Remove</th>
			</tr>
			<!-- Rows will be dynamically added here -->
		</table>
	</div>
	<footer>
		<p>E-Commerce System</p>
	</footer>
	<script>
		$(document).ready(function() {
			$.ajax({
				url : "http://localhost:8080/ecommerce-auction-system/api/wishlist",
				type : 'GET',
				success : function(result) {
					var table = $("#wishlistTable");
					let list = Array.isArray(result) ? result : result.wishlist || [result];
					list.forEach(function(auction) {
						var row = $("<tr></tr>");
						row.append($("<td></td>").text(auction.id));
						$.ajax({
							async:false,
							url : "http://localhost:8080/ecommerce-auction-system/api/items/" + auction.id,
							type : 'GET',
							success : function(result2) {
								console.log(result2)
								let list2 = Array.isArray(result2) ? result2 : result2.wishlist || [result2];
								list2.forEach(function(catalogue) {
									let auctionLink = "http://localhost:8080/ecommerce-auction-system/auction?id=" + auction.id;
				                    let linkElement = $("<a></a>")
				                        .attr("href", auctionLink)
				                        .text(catalogue.item_name);

				                    row.append($("<td></td>").append(linkElement));
								});
							},
							error : function(error) {
								console.log(error);
							}
						});
						row.append($("<td></td>").text("$" + auction.highestPrice));
						var endDate = new Date(parseInt(auction.endTime)*1000);
						row.append($("<td></td>").text(endDate));
						
						// Implements delete request functionality
						let deleteButton = $("<button>Remove</button>").click(function () {
						    $.ajax({
						        url: "http://localhost:8080/ecommerce-auction-system/api/wishlist/" + auction.id,
						        type: "DELETE",
						        success: function() {
						            alert("Remove from wishlist.");
						            row.remove();
						        },
						        error: function(err) {
						            console.log(err);
						            alert("Failed to remove item.");
						        }
						    });
						});

						row.append($("<td></td>").append(deleteButton));
						//row.append($("<td></td>").text("http://localhost:8080/ecommerce-auction-system/api/auction/" + auction.id));
						table.append(row);
					});
				},
				error : function(error) {
					console.log(error);
				}
			});
		});
	</script>
</body>
</html>