<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment Receipt</title>
<link rel="stylesheet" href="styles.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src = "notification.js"></script>
</head>
<body>

<header>
    <h1>Payment Receipt</h1>
</header>
<div id = "notification"></div>
<div class="container">
    <h2>Receipt Details</h2>
    <p id="receiptInfo"></p>

    <h2>Shipping Details</h2>
    <p id="shippingInfo"></p>
</div>

<footer>
    <p>Â© 2025 eCommerce Auction Platform</p>
</footer>

<script>
const params = new URLSearchParams(window.location.search);
const paymentId = params.get("paymentId");

$(document).ready(function() {

    if (!paymentId) {
        $("#receiptInfo").text("No payment ID provided.");
        return;
    }

    // Step 1: Fetch payment
    $.ajax({
        url: "http://localhost:8080/EECS4413-E-Commerce-System/api/payment?id=" + paymentId,
        type: "GET",
        success: function(payment){

            // Read expedited flag
            const expeditedUsed = payment.expeditedShipping ? "Yes" : "No";

            // Display payment info
            $("#receiptInfo").html(
                "<strong>Payment ID:</strong> " + payment.paymentId + "<br>" +
                "<strong>Amount Paid:</strong> $" + payment.amount + "<br>" +
                "<strong>Status:</strong> " + payment.status + "<br>" +
                "<strong>Payment Time:</strong> " + payment.paymentTime + "<br>" +
                "<strong>Expedited Shipping:</strong> " + expeditedUsed + "<br>"
            );

            // Step 2: Fetch auction details for shipping info
            $.ajax({
                url: "http://localhost:8080/EECS4413-E-Commerce-System/api/auctions?id=" + payment.auctionId,
                type: "GET",
                success: function(auction){
                    $("#shippingInfo").html(
                        "<strong>Shipping To:</strong><br>" +
                        payment.billingName + "<br>" +
                        payment.billingAddress + "<br>" +
                        payment.city + ", " + payment.state + " " + payment.postalCode + "<br>" +
                        payment.country + "<br><br>" +
                        "<strong>Item:</strong> " + auction.itemName + "<br>" +
                        "<strong>Shipping Time:</strong> " + auction.shippingTime + " days"
                    );
                },
                error: function(err){
                    $("#shippingInfo").text("Could not fetch auction shipping details.");
                    console.log(err);
                }
            });
        },
        error: function(err){
            $("#receiptInfo").text("Could not fetch payment details.");
            console.log(err);
        }
    });
});
</script>

</body>
</html>
