<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Catalogue</title>
<link rel="stylesheet" href="styles.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

	<header>
		<h1>Auction Catalogue</h1>

		<div class="search-bar">
			<input type="text" id="keywordInput" placeholder="Search keyword...">
			<button id="buttonInput">Search</button>
		</div>
		<p id="searchKeyword"></p>
	</header>
	
	<div class="container">
		<table id ="catalogueTable" border="1">
		<thead>
		 	<tr>
 				<th>Item Name</th>
 				<th>Current Bid</th>
 				<th>Auction Type</th>
 				<th>Remaining Time</th>
 				<th>View Details</th>
 			</tr>
 		</thead>
 <!-- Rows will be dynamically added here -->
 		</table>
		</div>
	<footer>
		<p>Â© 2025 eCommerce Auction Platform</p>
	</footer>

	<script>
 
function loadItems(keyword=""){
	
	let url = "http://localhost:8080/EECS4413-E-Commerce-System/api/items";
	//load only the items that match keyword, send it to controller
	if(keyword !== ""){
		url += "?keyword=" + encodeURIComponent(keyword);
		$("#searchKeyword").text("Search results for: " + keyword);
	} else {
		$("#searchKeyword").text("no results");
	}
	
	$.ajax({
		 url: url,
		 type: 'GET',
		 success: function(items){
		 //go through all items in database, list only their:
	     //name, current Bidding price, Auction Type, Remaining Time
	     //click view item button to move to view more item details and bid on item
	     var table = $("#catalogueTable");
		 var tbody = table.find("tbody");
		 
		 if(tbody.length === 0){
			 tbody = $("<tbody></tbody>")
			 table.append(tbody);
		 }
		 tbody.empty();
		 
		 if(items.length > 0){
 	     items.forEach(item => {
 		 	var row = $("<tr></tr>");
 			row.append($("<td></td>").text(item.item_name));
 			row.append($("<td></td>").text("$" + item.current_bid));
 			row.append($("<td></td>").text(item.auction_type));
 			row.append($("<td></td>").text(item.remaining_time));
 			
 			var button = $("<button>View Item</button>");
 			button.on("click", function(){
 				 viewItem(item.item_id);
 			})
 			row.append($("<td></td>").append(button));
 			tbody.append(row);
				
		 });
 	     } else {
		 
 	    	table.find("tbody").append("<td></td> No results found <td></td>");
 	     }
		},
		 error: function(error){
		 console.log("Cannot load Items", error);
		 	}
		 });
	
	}
	
	//Search button
	$("#buttonInput").click(function() {
		const keyword  = $("#keywordInput").val().trim();
		loadItems(keyword);
	});
	//Default laod all items as a Homepage
	$(document).ready(function() {
		loadItems();
	});
	//Go to specifc item using its id, go to item.html page to see item details and to bid for
	function viewItem(id) {
		window.location.href= "itemDetails?item_id=" + id;
	}
</script>

</body>
</html>
